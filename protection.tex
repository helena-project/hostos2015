\section{The Next-Generation Embedded OS:\\Protection \emph{is} a New Primitive}
\label{protection}

% pp 33--34, ch 1, sec 4:
In Tanenbaum's \emph{Modern Operating Systems} he asserts, ``The main property
which distinguishes embedded systems from handhelds is the certainty that no
untrusted software will ever run on it''~\cite{tanenbaum}. In this paper we
argue that this is no longer the case.
% As a class of device, embedded systems
% are evolving beyond the single-application case, and as a consequence, they
% require their operating system to provide process isolation, enforced resource
% arbitration, and protection.
Embedded systems
are evolving beyond the single-application case and now
require an operating system that provides process isolation, enforced resource
arbitration, and protection.

% Today, we are designing \name, a new embedded operating system that (amongst
% other goals) explores how to add protection as a primitive to constrained
% systems
\name explores how to add protection as a primitive to constrained
systems.
We begin by examining recent advances and trends in embedded
hardware and systems language design with an eye towards applying these
new capabilities to our embedded OS concept.

%\name takes advantage of three emerging trends, modern language design, new
%microcontroller hardware capabilities, and contemporary multi-MCU system design,
%that afford new opportunites to provide protection.

%\input{protection-memory}
%\input{protection-multicore}

\subsection{Hardware Advances and Trends}

Modern ARM devices come in three flavors: the powerful A-series
microprocessors, the real-time R-series, and the efficient M-series
microcontrollers.
\hl{XXX: Why M over A}

{\bf Memory Protection Units.}
In lieu of costly Memory Management Units (MMUs), the Cortex-M series includes
a Memory Protection Unit (MPU). Like MMUs, MPUs trap illegal memory accesses
(e.g. writing to read-only memory). MPUs do not perform any translation, so
mechanisms such as swap are unavailable. With OS assistance, however, an MPU
with position independent code (PIC) can enable isolated applications, shared
libraries, and even possible relocation of running code.
% Pat: I'm 90% sure of how to do relocation with PIC, but I need to think about it more
MPUs are also interesting as they are typically much more fine-grained than
virtual memory, able to address regions as small a 32~bytes whereas MMUs
typically divide memory into pages of at least 4~KB.

{\bf ``Multi-Core'' MCUs.}
% XXX: This section is a work-in-progress...
Modern embedded platforms increasingly include multiple microcontrollers.
Often, peripheral devices like radio modules are actually a full blown
microcontroller that allows the application controller to offload low-level radio
functionality and reduce overall power~\cite{nrf51822,cc2540}. In other cases,
a similar microcontroller with a different energy profile is added to provide
a runtime option for an energy-performance tradeoff.  For example, the Nest
Protect includes a main Cortex-M4 application controller, a secondary
Cortex-M0+ peripheral processor and the EM357 802.15.4 radio SoC, which has an
additional onboard Cortex-M3~\cite{nestprotect-teardown}.

% ARM TrustZone is also functionally like having a separate core, or at least
% that's the abstraction it tries to provide. Only available on Cortex-A's
% though

% Could also be interesting to talk about crypto co-processors here

Systems with multiple, hetergeneous processors provide an opportunity for
the strictest isolation, stochastic and deterministic real-time schedules, and
computation offloading. It is less clear, however, how to abstract
system-specific hardware for general applications and is an open question in
the design of \name.

%% OLD TEXT: impl-heavy
% \name leverages multiprocessor environments to provide protection where
% language-level and memory isolation are insufficient. In a multi-application
% environment, time-sensitive applications (e.g. that must process requests
% within a single radio scheduling quantum) are protected from interference by,
% e.g compute heavy applications. In addition, \name schedules applications on
% different processors to applications handling sensitive data from side-channel
% attacks by other applications.

%Advances:
%  MPUs
%    -- capabilities
%    -- MPU vs MMU (seed of both?)
%
%Trends:
%  M vs A
%    -- Why deeply embedded (M) still relevant
%    -- Maybe Pebble vs other watches example?
%
%  Multi-Core (really Multi-MCU?)
%    -- solid protection / boundary
%    -- compare with TrustZone?
%    -- App / HW specific; need to expose but can't feature / focus / rely on


\input{protection-pl}

